"""
Brute force form authentication to check for weak passwords
"""
__author__ = "Maarten Schermer"

import sys,time
from os.path import dirname,abspath

# Importing PinkWave extensions
sys.path.append(dirname(dirname(dirname(abspath(__file__)))))
from extensions.Util import Util,report,payloads
import extensions.Request as Request
from lib.Browser import NoSuchElementException

def labels():
    return ['A5 - Security Misconfiguration']

def options():
    return ['target','requestNames']

def start(pentest):
    for payload in payloads("bruteforce",__file__):
        username,password = payload.strip("\n").split(":",1)
        Request.post(pentest.target,pentest.requestNames,[username, password])
        for formname in pentest.requestNames:
            try:
                pentest.browser.getElementByName(formname)
            except NoSuchElementException:
                report("Found account: %s:%s" % (username,password))
