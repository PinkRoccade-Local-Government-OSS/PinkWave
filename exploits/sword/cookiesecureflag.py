"""
Scan a target website cookies for Secure flag
(To prevent server from sending cookie over unencrypted communication)
"""
__author__ = "sword"

import sys,time
from os.path import dirname,abspath

# Importing PinkWave extensions
sys.path.append(dirname(dirname(dirname(abspath(__file__)))))
from extensions.Util import Util,report,payloads
import extensions.Request as Request

def labels():
    return ['A5 - Security Misconfiguration']

def options():
    return ['target']

def start(pentest):
    r1 = Request.get(pentest.target)
    if len(r1.cookies) == 0:
        print "No cookies found"
    else:
        cookieNames = []
        for cookie in r1.cookies:
            if cookie.get("secure") is False:
                cookieNames.append(cookie.get("name"))

        if len(cookieNames) != 0:
            report("secure flag missing for %s" % ",".join(cookieNames))
