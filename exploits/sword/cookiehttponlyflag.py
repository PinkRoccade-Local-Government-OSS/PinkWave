"""
Scan a target website cookies for HTTPOnly flag
(To prevent JavaScript from read/writing document.cookie)
"""
__author__ = "Maarten Schermer"

import sys,time
from os.path import dirname,abspath

# Importing PinkWave extensions
sys.path.append(dirname(dirname(dirname(abspath(__file__)))))
from extensions.Util import Util,report,payloads
import extensions.Request as Request

# (Optional) Specify label list
def labels():
    return ['A5 - Security Misconfiguration']

def options():
    return ['target']

def start(pentest):
    r1 = Request.get(pentest.target)
    if len(r1.cookies) == 0:
        print "No cookies found"
    else:
        cookieNames = []
        for cookie in r1.cookies:
            if cookie.get("httpOnly") is False:
                cookieNames.append(cookie.get("name"))

        if len(cookieNames) != 0:
            report("HttpOnly flag missing for %s" % ",".join(cookieNames))
