"""
Brute force common files to check for sensititive accessible files
"""
__author__ = "Maarten Schermer"

import sys
import requests
from os.path import dirname,abspath

# Importing PinkWave extensions
sys.path.append(dirname(dirname(dirname(abspath(__file__)))))
from extensions.Util import Util,report,payloads
import extensions.Http as Http
import lib.colors as colors

# (Optional) Specify label list
def labels():
    return ['A5 - Security Misconfiguration']

def options():
    return ['target']

def start(pentest):
    foundFiles = []

    if pentest.wordlist is not None:
        with open(pentest.wordlist,"r") as f:
            for payload in f.readlines():
                if len(payload.strip()) == 0:
                    continue

                url = pentest.target + "/" + payload
                exists = checkExists(url)
                if exists:
                    foundFiles.append(url)
    else:
        for payload in payloads("commonfiles",__file__):
            url = pentest.target + "/" + payload
            exists = checkExists(url)
            if exists:
                foundFiles.append(url)

    if len(foundFiles) != 0:
        report("Hidden files found: " + ",".join(foundFiles))

def checkExists(url):
    exists = Http.is_ok(url)
    if exists:
        if Util.getConfig("debug"):
            print "%s%s:%d%s" % (colors.RED, url, 200, colors.COLOR_END)
    else:
        if Util.getConfig("debug"):
            print "%s%s:%d%s" % (colors.PURPLE, url, 404, colors.COLOR_END)
    return exists
