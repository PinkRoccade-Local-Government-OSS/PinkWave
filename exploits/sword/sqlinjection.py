"""
Performs SQL injection payloads on selected form,
Looks for the string "error"
"""
__author__ = "Maarten Schermer"

import sys,os
from os.path import dirname,abspath
from os import walk

# Importing PinkWave extensions
sys.path.append(dirname(dirname(dirname(abspath(__file__)))))
from extensions.Flags import Flags
from extensions.Util import Util,report,payloads
import extensions.Request as Request

# (Optional) Specify label list
def labels():
    return ['A1 - Injection']

# (Required) Specify options for script
def options():
    return ['target','requestNames','request']

# (Required) Enables you to start the script via pinkwave.py
def start(pentest):
    # Execute normal requests
    requestList = []
    for normalParam in ['hi','hello','0']:
        r = Request.do(pentest, normalParam)
        requestList.append(r)

    # Compare to exploit test
    for payload in payloads("sql",__file__):
        r = Request.do(pentest,payload)
        flags = Flags(r,requestList)
        flags.timeout(8)
        flags.containsKeyword(" error ")
